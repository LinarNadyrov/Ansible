---
# tasks file for Unlock_Users
- name: Create a folder "shared" in tadb
  become: yes
  file:
    path: "{{ item }}" 
    state: directory
    owner: "{{ owner }}"
    group: "{{ group }}"
    mode: "{{ mode }}"
  with_items:
  - " {{ destin_file_sql }} "

- name: Copy SQL files with "ansible" to "tadb"
  become: yes
  tags: Lock
  copy: 
    src: "{{ item }}"
    dest: "{{ destin_file_sql }}"
    mode: "{{ mode }}" 
    owner: "{{ owner }}"
    group: "{{ group }}"
  with_fileglob: 
    - "{{ source_file_sql }}/*"

- name: Unlock (Разблокировать) Users in "tadb"
  become: yes
  become_method: sudo
  become_user: postgres
  shell: /usr/bin/psql -f "{{ destin_file_sql }}unlock.sql" --echo-errors --echo-queries 2>&1

- name: Removing folder "shared" in tadb
  become: yes
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - "{{ destin_file_sql }}"
